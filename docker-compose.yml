services:
  # Service: Backend Application
  # Role: Handles business logic and file encryption/storage.
  # Security: Not exposed publicly; reachable only via the internal network.
  server:
    image: srs-backend:latest
    container_name: srs-backend-container
    build:
      context: .
      dockerfile: server/Dockerfile
    expose:
      - "5000"
    volumes:
      # Bind Mount: Maps local storage directory to container storage.
      # Enables data persistence and host-side verification.
      - ./server/storage:/app/server/storage
    networks:
      - srs-secure-net

  # Service: Secure Proxy
  # Role: Handles SSL encryption and request forwarding.
  # Security: Exposed to host machine on port 443 (HTTPS).
  nginx:
    image: srs-proxy:latest
    container_name: srs-proxy-container
    build:
      context: ./nginx
      dockerfile: Dockerfile
    ports:
      - "443:443"
    depends_on:
      - server
    networks:
      - srs-secure-net

# Network Configuration
# Defines an isolated bridge network for inter-container communication.
networks:
  srs-secure-net:
    name: srs-internal-network
